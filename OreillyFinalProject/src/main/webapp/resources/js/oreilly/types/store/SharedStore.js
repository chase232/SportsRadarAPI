//>>built
define("oreilly/types/store/SharedStore",["dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/request/xhr","dojo/Deferred","dojo/store/Memory","dojo/Evented","dojo/ready","dijit/registry","dojo/on","dijit/Destroyable","dojo/aspect"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,on,_a,_b){function _c(_d,_e){var _f;if(_d.stores[_e].widget.parentStore){return;}_d.stores[_e].value=_d.stores[_e].widget.get("value");_d.stores[_e].widget.parentStore=this;_f=_b.after(_d.stores[_e].widget,"destroy",function(){_d.widgetDestroyed(this);});_d.own(on(_d.stores[_e].widget,"change",function(val){_d.updateValue(this,val);}),_f);};function _10(_11,_12,_13){var wg=_9.byId(_12),_14=_13||1;if(wg){_11.stores[_12].widget=wg;_c(_11,_12);}else{if(_14>3){return;}setTimeout(function(){_10(_11,_12,_14+=1);},50*_13);}};function _15(_16,_17){if(_17!==undefined&&_17!==null){if(typeof _17==="function"){_16.setData(_16.data.sort(_17));}else{_16.setData(_16.data.sort(function(a,b){if(typeof _17==="string"){if(a[_17]<b[_17]){return -1;}if(a[_17]>b[_17]){return 1;}return 0;}else{return a[_17]-b[_17];}}));}}};return _1("oreilly.types.store.SharedStore",[_6,_7,_a],{stores:{},sortAttribute:null,updateValue:function(_18,_19){this.stores[_18.get("id")].value=_19;this.updateStores();},widgetDestroyed:function(_1a){if(this.stores[_1a.id]){delete this.stores[_1a.id];}this.updateStores();},updateStores:function(){var _1b=new _6(_3.clone(this.originalParams)),_1c,_1d,_1e=this,i,_1f,_20,_21=[],_22=true;_1d=_1e.stores;for(_1c in _1d){if(_1d.hasOwnProperty(_1c)){if(_1d[_1c].value!==null&&_1d[_1c].value!==undefined&&_1d[_1c].value!==""){if(_1d[_1c].value instanceof Array){_20=_1d[_1c].value;_1f=_20.length;for(i=0;i<_1f;i+=1){_1b.remove(_20[i]);}}else{_1b.remove(_1d[_1c].value);}}}}for(_1c in _1d){if(_1d.hasOwnProperty(_1c)){_1d[_1c].store.setData(_3.clone(_1b.data));if(!_1d[_1c].widget){_1d[_1c].widget=_9.byId(_1c);if(_1d[_1c].widget){_c(_1e,_1c);}}if(_1d[_1c].widget){if(_1d[_1c].value!==null&&_1d[_1c].value!==undefined&&_1d[_1c].value!==""){if(_1d[_1c].value instanceof Array){_20=_1d[_1c].value;_1f=_20.length;for(i=0;i<_1f;i+=1){if(_1e.index[_20[i]]!==undefined){_1d[_1c].store.put(_1e.get(_20[i]));_21.push(_20[i]);}else{_22=false;}}_15(_1d[_1c].store,_1e.sortAttribute);if(!_22){_1d[_1c].widget.set("value",_21.length>1?_21:_21[0]);}}else{if(_1e.index[_1d[_1c].value]!==undefined){_1d[_1c].store.put(_1e.get(_1d[_1c].value));_15(_1d[_1c].store,_1e.sortAttribute);}else{_1d[_1c].widget.set("value","");}}}_1d[_1c].widget.set("store",_1d[_1c].store);if(_1d[_1c].widget.refresh){_1d[_1c].widget.refresh();}}}}},constructor:function(_23){var _24=this;this.inherited(arguments);this.originalParams=_23;delete this.originalParams.id;_3.mixin(this,_23);_8(function(){var _25,_26;_24.ready=true;_26=_24.stores;for(_25 in _26){if(_26.hasOwnProperty(_25)){if(!_26[_25].widget){_26[_25].widget=_9.byId(_25);}if(!_26[_25].widget){return;}_c(_24,_25);}}_24.updateStores();});},createStore:function(_27){if(!_27){return;}this.stores[_27]={store:new _6(this.originalParams),widget:_9.byId(_27)||null,value:null};if(this.stores[_27].widget){_c(this,_27);}else{if(this.ready){_10(this,_27);}}this.updateStores();return this.stores[_27].store;},setData:function(_28){this.inherited(arguments);if(!this.originalParams){this.originalParams={};}this.originalParams.data=_28;this.updateStores();}});});