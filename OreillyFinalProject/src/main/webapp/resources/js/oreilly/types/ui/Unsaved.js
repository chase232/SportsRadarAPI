//>>built
define("oreilly/types/ui/Unsaved",["dojo/_base/declare","dijit/_WidgetBase","dojo/on","dojo/query","dojo/ready","dijit/registry","oreilly/types/ui/Confirmation","dojo/aspect","dojo/_base/array"],function(_1,_2,on,_3,_4,_5,_6,_7,_8){var _9=1;return _1("oreilly/types/ui/Unsaved",[_2],{unsaved:false,msg:"Are you sure?",baseClass:"confirmationWidget",title:"Are you sure?",content:"You will lost your changes if you navigate away",confirmLabel:"OK",cancelLabel:"Cancel",cancelClass:"btn btn-default",confirmClass:"btn btn-primary",cancel:null,addWidget:function(_a){var _b,_c=this;if(_a===undefined||_a===null){return;}if(_a instanceof Array){_8.forEach(_a,function(_d){_c.addWidget(_d);});return;}_b=_5.byId(_a.id||_a);if(!_b){return;}if(this.handlers[_b.id]){delete this.handlers[_b.id];}this.handlers[_b.id]={widget:_b,values:_b.getValues?JSON.stringify(_b.getValues()):(""+(_b.get("value")))};},removeWidget:function(_e){var _f=this;if(_e===undefined||_e===null){return;}if(_e instanceof Array){_8.forEach(_e,function(_10){_f.removeWidget(_10);});return;}var id=_e.id||_e;if(this.handlers[id]){delete this.handlers[id];}},markAsUnsaved:function(){this.unsaved=true;},markAsSaved:function(){this.unsaved=false;},_checkSaved:function(){var _11=this,wg,_12=_11.handlers,_13=false,_14;if(this.unsaved){_13=true;}else{for(wg in _12){if(_12.hasOwnProperty(wg)){wg=_12[wg];_14=wg.widget.getValues?JSON.stringify(wg.widget.getValues()):(""+wg.widget.get("value"));if(_14!==wg.values){_13=true;break;}}}}return _13;},_showMsg:function(_15,_16){var _17=this;new _6({title:_17.title,content:_17.content,confirmLabel:_17.confirmLabel,cancelLabel:_17.cancelLabel,baseClass:_17.baseClass,cancelClass:_17.cancelClass,confirmClass:_17.confirmClass,confirm:_15,cancel:_16||_17.cancel||function(){}}).show();},checkSaved:function(_18,_19){var _1a=this._checkSaved();if(_1a&&(_18||_19)){this._showMsg(_18,_19);}return _1a;},reload:function(){var _1b=this,wg,cwg,_1c=_1b.handlers;_1b.addWidget(_3("[data-check-changes=true]"));_1b.addWidget(_3("form",_1b.domNode?_1b.domNode.parentNode:document));for(wg in _1c){if(_1c.hasOwnProperty(wg)){cwg=_1c[wg];if(cwg.widget.declaredClass!=="dijit/form/Form"&&cwg.widget.declaredClass!=="dijit.form.Form"){if(!_5.byId(wg)){delete _1b.handlers[wg];}else{_1b.handlers[wg].values=""+(cwg.widget.get("value"));}}}}},postCreate:function(){var _1d=this;_1d.handlers={};_1d.linkHandlers={};_4(9,function(){_1d.reload();_3("[data-check-reload=true]").forEach(function(el){var _1e=_5.getEnclosingWidget(el),_1f,id;if(!_1e){id=el.id;_1f=on(el,"click",function(){_1d.reload();});}else{id=_1e.get("id");_1f=on(_1e,"click",function(){_1d.reload();});}_1d.linkHandlers[id]=_1f;});_3("[data-check-unsaved=true]").forEach(function(el){var _20=_5.getEnclosingWidget(el),_21,id;if(!_20){id=el.id;_21=on(el,"click",function(e){if(el.checked){el.checked=false;}else{var _22=_1d._checkSaved();if(_22){e.preventDefault();e.stopImmediatePropagation();e.stopPropagation();_1d._showMsg(function(){el.checked=true;el.click();},function(){_1d.cancel&&_1d.cancel();});return false;}}});}else{id=_20.get("id");_21=_7.around(_20,"_onClick",function(_23){return function(_24,_25){var _26=_1d._checkSaved();if(_26){_20.disabled=true;_1d._showMsg(function(){_20.disabled=false;_23.call(_20,_24,_25);},function(){_20.disabled=false;_1d.cancel&&_1d.cancel();});}else{_23.call(_20,_24,_25);}};});}_1d.linkHandlers[id]=_21;});});}});});