//>>built
define("oreilly/types/ui/PanelParent",["dojo/_base/declare","dojo/_base/lang","dijit/_WidgetBase","dijit/_TemplatedMixin","dojo/dom-construct","dojo/on","oreilly/types/ui/Panel","dojo/topic","dojo/store/Memory","dojo/dom-class","dojo/dom-attr","dojo/query","dojo/Evented"],function(_1,_2,_3,_4,_5,on,_6,_7,_8,_9,_a,_b,_c){var _d="panelParent/action",_e="/toggle";EXPAND_ACTION="expand",ADD_ACTION="add",REMOVE_ACTION="remove",COLLAPSE_ACTION="collapse";return _1("oreilly/types/ui/PanelParent",[_3,_4,_c],{addLabel:"Add Panel",templateString:"<div class=\"well well-${baseClass} no-padding-bottom\" id=\"${id}\" data-dojo-attach-point=\"well, focusNode, textbox\"><p class=\"text-center nomarginbottom\" data-dojo-attach-point=\"addLinkP\"><a href=\"#\" data-dojo-attach-point=\"addLink\">${addLabel}</a><p/></div>",baseClass:"parentPanel",panelWidget:_6,bodyWidget:null,data:null,value:null,handles:{},counter:0,maxPanels:100,removeCallback:null,readOnly:false,_togglePanel:function(id,_f,_10){var _11,_12=this.panels;if(id){if(_12[id]&&_12[id][_f]){_12[id][_f]();}on.emit(this,_d,{id:id,action:_f});return;}for(_11 in _12){if(_12.hasOwnProperty(_11)){if(_11==="length"||_11===_10){continue;}if(_12[_11][_f]){_12[_11][_f]();}}}},_getValueAttr:function(){var _13=this.panels,_14,val=[];for(_14 in _13){if(_13.hasOwnProperty(_14)){if(_14==="length"){continue;}val.push(_13[_14].get("value"));}}return val;},_setValueAttr:function(_15,id){var _16,_17=this.panels,i=0;if(id===undefined){if(this.data){this.data.setData(_15);this.refresh();}else{this.refresh(_15);}}else{if(this.panels[id]){this.panels[id].set("value",_15);}}},_setReadOnlyAttr:function(_18){this.readOnly=_18;var _19,_1a=this.panels;if(_18){_9.add(this.addLink,"hidden");}else{_9.remove(this.addLink,"hidden");}for(_19 in _1a){if(_1a.hasOwnProperty(_19)){if(_19==="length"){continue;}_1a[_19].set("readOnly",_18);}}},refresh:function(_1b){var _1c=this,_1d=this.panels,_1e,_1f=this.data,_20,_21,i,_22,_23=(_1f&&_1f.idProperty)||"id";if(_1b===undefined&&_1f.loadData){_1f.loadData().then(function(_24){_1c.refresh(_24);});}if(_1b){_1f=new _8({data:_1b,idProperty:_23});}_21=_1f.query({});if(_21.then){_21.then(function(_25){_1c.refresh(_25);});}for(_1e in _1d){if(_1d.hasOwnProperty(_1e)){if(_1e==="length"){continue;}_20=_1f.get(_1d[_1e].get("objectId"));if(_20){_1d[_1e].set("value",_20);}else{_1c.removePanel(_1e,true);}}}_22=_21.length;for(i=0;i<_22;i+=1){if(_1c.panels.length>=_1c.maxPanels){return;}if(_21[i][_23]!==undefined){if(!_1d[_1c.id+"-panel-"+_21[i][_23]]){_1c.addPanel(null,null,null,null,_21[i],_23);}}}_1c.removePanel();},constructor:function(){var _26=arguments[0];this.panelArgs={};if(_26.secondActionLabel){this.panelArgs.secondActionLabel=_26.secondActionLabel;}if(_26.removeLabel){this.panelArgs.removeLabel=_26.removeLabel;}if(_26.expandLabel){this.panelArgs.expandLabel=_26.expandLabel;}this.inherited(arguments);},postCreate:function(){var _27=this,_28=_27.panelWidget,_29;function _2a(_2b){var i,_2c=_2b.length;for(i=0;i<_2c;i+=1){if(_27.panels.length>=_27.maxPanels){return;}_27.addPanel(null,_27.panelArgs,null,null,_2b[i],_27.data.idProperty||"id");}};_27.panels={length:0};_27.handles.remove=_7.subscribe("panel/remove/"+_27.id,function(id){_27.removePanel(id);});_27.handles.hideAll=_7.subscribe("panel/hideall/"+_27.id,function(id,_2d){_27.collapsePanels(id,_2d);});_27.own(on(_27.addLink,"click",function(e){e.preventDefault();_27.addPanel();}),_27.handles.remove,_27.handles.hideAll);if(_27.readOnly){_9.add(_27.addLink,"hidden");}else{_9.remove(_27.addLink,"hidden");}if(_27.data){if(_27.data.loadData){_27.data.loadData().then(_2a);}else{_29=_27.data.query({});if(_29.then){_29.then(_2a);}else{_2a(_29);}}}else{_27.addPanel(null,_27.panelArgs);}},addPanel:function(_2e,_2f,_30,_31,_32,_33){var _34,_35=this,_36=_2e||_35.panelWidget,_37,id,_38;_2f=_2f||{};if(_35.panels.length>=_35.maxPanels){return;}if(_32){_37=_33||"id";id=_35.id+"-panel-"+(_32[_37]!==undefined?_32[_37]:_35.counter);}else{id=_35.id+"-panel-"+_35.counter;}_2.mixin(_2f,_35.panelArgs);_34={id:id,objectId:_32?_32[_37]:_35.counter,parentId:_35.id,data:_32,messages:_35.messages||{}};_2.mixin(_34,_2f);if(!_34.bodyWidget){_34.bodyWidget=_35.bodyWidget;}_35.collapsePanels();_38=_5.place("<div>",_30||_35.addLinkP,_31||"before");if(typeof _36=="function"){_35.panels[_34.id!==undefined?_34.id:id]=new _36(_34,_38);_35.panels.length+=1;_35.counter+=1;if(_35.panels.length>=_35.maxPanels){_9.add(_35.addLink,"hidden");}on(_35.panels[_34.id!==undefined?_34.id:id],_35.id+_e,function(){on.emit(_35,_d,arguments[0]);});}else{(function(_39,_3a,_3b,_3c){require([_39],function(_3d){_3c.panels[_3a.id!==undefined?_3a.id:id]=new _3d(_3a,_3b);_3c.panels.length+=1;_3c.counter+=1;if(_3c.panels.length>=(_3c.maxPanels-1)){_9.add(_3c.addLink,"hidden");}on(_3c.panels[_3a.id!==undefined?_3a.id:id],_3c.id+_e,function(){on.emit(_3c,_d,arguments[0]);});});}(_36,_34,_38,_35));}on.emit(_35,_d,{id:(_34.id!==undefined?_34.id:id),action:ADD_ACTION});},removePanel:function(id,_3e){var _3f,id,_40,_41=this;function _42(_43){if(_43!==true){return;}_9.remove(_41.addLink,"hidden");if(_41.panels[id]){_41.panels[id].destroyRecursive();delete _41.panels[id];_41.panels.length-=1;on.emit(_41,_d,{id:id,action:REMOVE_ACTION});}if(!_3e&&_41.panels.length<1){_41.addPanel();}_3f=_b(".panel > .panel-body:not(.hidden)",_41.well);if(_3f.length>0){return;}_3f=_b(".panel",_41.well);if(_3f.length>0){id=_a.get(_3f.pop(),"data-panelid");if(id!==undefined||id!==null){_41.expandPanels(id);}}};if(_41.removeCallback){_40=_41.removeCallback(id,_41);if(_40.then){_40.then(_42);}else{if(_40===true){_42(_40);}}}else{_42(true);}},collapsePanels:function(id,_44){this._togglePanel(id,COLLAPSE_ACTION,_44);},expandPanels:function(id){this._togglePanel(id,EXPAND_ACTION);},getPanels:function(){var _45=this.panels,_46=[];for(panel in _45){if(_45.hasOwnProperty(panel)){if(panel==="length"){continue;}_46.push(_45[panel]);}}return _46;},set:function(_47,_48){if(_47==="maxPanels"){if(this.panels.length>=(_48-1)){_9.add(this.addLink,"hidden");}else{_9.remove(this.addLink,"hidden");}}this.inherited(arguments);}});});