//>>built
define("oreilly/types/form/FilteringSelectWithSpinner",["dojo/_base/declare","dijit/form/FilteringSelect","dojo/dom-class","dojo/_base/array","dojo/on","dojo/aspect","dijit/registry","dojo/ready"],function(_1,_2,_3,_4,on,_5,_6,_7){function _8(_9,_a,_b,_c){var _d=_9.searchDelay;_9.store.serverQueryParameters={};if(_b&&(_9.parentSearchAttr!==null&&_9.parentSearchAttr!==undefined)){_9.store.serverQueryParameters[_9.parentSearchAttr]=_a;}else{_9.store.serverQueryParameters[_9.searchAttr]=_a;}if(_9.promise&&!_9.promise.isCanceled()){_9.promise.cancel();}startQuery=function(){_9.promise=_9.store.loadData();_9.promise.then(function(){_9._startSearch(_a,true);_3.remove(_9.textbox,"filteringselect-spinning");});};if(!_d||!_c){startQuery();}else{if(_9._queryDeferHandle){_9._queryDeferHandle.remove();}_9._queryDeferHandle=_9.defer(startQuery,_d);}};function _e(_f){return _f.store&&_f.store.declaredClass==="oreilly.types.store.MemoryStoreFromJson"&&_f.store.url;};function _10(_11){if(_11.originalValue!==undefined){_11.set("value",_11.originalValue);delete _11.originalValue;}else{_11.set("value",null);}};return _1("oreilly.types.form.FilteringSelectWithSpinner",[_2],{minKeyCount:0,loadDataOnStartup:false,promise:null,parentId:null,parentSearchAttr:null,postCreate:function(_12){var _13=this;_13.inherited(arguments);on(_13,"onSearch",function(){_3.remove(_13.textbox,"filteringselect-spinning");});},postMixInProperties:function(){this.originalValue=this.value;this.inherited(arguments);},_openResultList:function(_14,_15,_16){if(_14.length===1){this.set("item",_14[0]);this.closeDropDown(true);return;}this.inherited(arguments);},_setStoreAttr:function(_17){var _18=this;_18.inherited(arguments);if(_18.store.loadData){_18.own(_5.after(_18.store,"loadData",function(_19){_3.add(_18.textbox,"filteringselect-spinning");_19.otherwise(function(){_3.remove(_18.textbox,"filteringselect-spinning");});return _19;}),_5.after(_18.store,"setData",function(){_3.remove(_18.textbox,"filteringselect-spinning");}));}},_startSearch:function(key,_1a){var fs=this;key=(key!=null)?(key+""):key;if(fs.minKeyCount){if(!key||key.length<fs.minKeyCount){_3.remove(fs.textbox,"filteringselect-spinning");fs.closeDropDown();return;}_3.add(fs.textbox,"filteringselect-spinning");}if(fs.hasDownArrow&&_e(fs)&&fs.store.data.length>0){_1a=true;}if(_e(fs)&&!_1a){_8(fs,key,false,true);if(!fs._queryDeferHandle){fs.promise.then(function(){fs._startSearch(key,true);_3.remove(fs.textbox,"filteringselect-spinning");});}return;}fs.inherited(arguments);},_setDisplayedValueAttr:function(_1b,_1c){if(_1b&&this.isValid()){_3.add(this.textbox,"filteringselect-spinning");}else{_3.remove(this.textbox,"filteringselect-spinning");}this.inherited(arguments);},startup:function(){var _1d=this;this.inherited(arguments);if(this.loadDataOnStartup){this.promise=this.store.loadData();}this.watch("item",function(_1e,_1f,_20){_3.remove(this.textbox,"filteringselect-spinning");});_7(function(){var _21=_6.byId(_1d.parentId);if(_21){if(_21.get("value")!==null&&_21.get("value")!==undefined&&_21.get("value")!==""){if(_e(_1d)){_8(_1d,_21.get("value"),true);_1d.promise.then(function(){_10(_1d);_3.remove(_1d.textbox,"filteringselect-spinning");});}else{_10(_1d);}}else{_1d.set("disabled",true);}on(_21,"change",function(val){_1d.set("disabled",true);_1d.set("value",null);if(val===""){return;}if(_e(_1d)){_8(_1d,val,true);if(_1d.promise){_1d.promise.then(function(){_10(_1d);_1d.set("disabled",false);});}else{_10(_1d);_1d.set("disabled",false);}}else{_10(_1d);}});}else{if(_e(_1d)&&(_1d.originalValue!==undefined&&_1d.originalValue!==null&&_1d.originalValue!=="")){_8(_1d,_1d.originalValue,true);if(_1d.promise){_1d.promise.then(function(){_10(_1d);_1d.set("disabled",false);});}else{_10(_1d);_1d.set("disabled",false);}}}});},_onBlur:function(e){this.inherited(arguments);_3.remove(this.textbox,"filteringselect-spinning");}});});