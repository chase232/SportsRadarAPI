//>>built
define("oreilly/types/dgrid/DnDPagingGrid",["dojo/_base/declare","dojo/_base/lang","oreilly/types/dgrid/PagingGrid","dgrid/extensions/DnD","oreilly/types/store/createOrderedStore","dojo/on","oreilly/types/store/StoreAdapter","dstore/Trackable","dojo/store/Observable","dojo/has","dojo/dnd/Manager"],function(_1,_2,_3,_4,_5,on,_6,_7,_8,_9,_a){return _1("oreilly.types.dgrid.DnDPagingGrid",[_3,_4],{"-chains-":{constructor:"manual"},dirty:{},_orderStore:function(){var _b=this.orderField;this.store.query({},{sort:[{attribute:_b}]}).forEach(function(_c,ix){_c[_b]=ix+1;});return this;},_track:function(){var _d=this,_e;if(this.store){var _f=this.store.query({});if(!_f.observe){this.store=new _8(this.store);_f=this.store.query({});}_f.observe(function(obj,_10,_11){if(_10===-1&&obj[_d.orderField]!=null){obj[_d.orderField]=obj[_d.orderField]-1;}_d._orderStore();_d.collection.setData(_d.store.data);});}_e=this.collection._orderStore().track();_e.on("add, update, delete",function(_12){_e._orderStore();if(_d.store){_d.store.setData(_d.collection.storage.fullData);}_d.refresh();on.emit(_d.domNode,"dndgrid-drop",{bubbles:true,cancelable:true,details:{beforeId:_12.beforeId,target:_12.target,type:_12.type}});});},postCreate:function(){var _13=this;_13.orderField=_13.orderField||"order";this.inherited(arguments);if(this.store){if(this.store.loadData){on(this.store,"data-loaded",function(){_13.set("collection",_5({data:_13.store.data,orderField:_13.orderField}).sort(_13.orderField));_13.collection.loadData=function(){return _13.store.loadData();};_13._track();});}else{this.collection=_5({data:_13.store.data,orderField:_13.orderField}).sort(_13.orderField);this._track();}}else{_13.set("collection",_5({data:_13.collection.storage.fullData,orderField:_13.orderField}).sort(_13.orderField));this._track();}this.dndSource.onMouseMove=this.onMouseMove;},bufferRows:5,farOffRemoval:400,getObjectDndType:function(_14){return [_14.type?_14.type:this.dndSourceType];},dndSourceType:this.id+"-row",dndParams:{withHandles:true},onMouseMove:function(evt){if(this.isDragging&&this.targetAnchor&&this.grid.preventDrop&&this.anchor!=this.targetAnchor){var m=_a.manager();m.canDrop(this.grid.preventDrop.call(this.grid,this.grid.row(this.targetAnchor).data));}if(!_9("touch")||touchUtil.countCurrentTouches(evt,this.grid.touchNode)<=1){this.inherited(arguments);}},});});