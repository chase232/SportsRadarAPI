//>>built
define("oreilly/types/dgrid/CustomPagination",["dgrid/_StoreMixin","dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/on","dojo/dom-class","dojo/query","dojo/string","dojo/has","dojo/when","put-selector/put","dgrid/util/misc","dojo/i18n!dgrid/extensions/nls/pagination","dojo/_base/sniff","xstyle/css!dgrid/css/extensions/Pagination.css"],function(_1,_2,_3,_4,on,_5,_6,_7,_8,_9,_a,_b,_c){function _d(_e){_e._setHeight();if(_e.noDataNode){_a(_e.noDataNode,"!");delete _e.noDataNode;}else{_e.cleanup();}_e.contentNode.innerHTML="";};function _f(_10){if(_10.loadingNode){_a(_10.loadingNode,"!");delete _10.loadingNode;}else{if(_10._oldPageNodes){for(var id in _10._oldPageNodes){_10.removeRow(_10._oldPageNodes[id]);}delete _10._oldPageNodes;}}delete _10._isLoading;};return _2(_1,{rowsPerPage:10,pagingTextBox:false,previousNextArrows:true,firstLastArrows:false,pagingLinks:2,pageSizeOptions:null,showLoadingMessage:true,i18nPagination:_c,showFooter:true,_currentPage:1,buildRendering:function(){this.inherited(arguments);this.firstLastArrows=true;this.previousNextArrows=true;var _11=this,_12=_a(this.domNode,"+#paginationParent.text-center"),_13=this.paginationStatusNode=_a(this.domNode,"+div#paginationStatusNode"+this.id+".text-center"+(_11.showPaginationStatusNode==false?".hidden":"")),_14=this.paginationNode=_a(_12,"div#paginationNode"+this.id+".pagination"),_c=this.i18nPagination,_15,_16;_13.tabIndex=0;this._updatePaginationSizeSelect();this._updateRowsPerPageOption();this._updatePaginationStatus(this._total);_15=this.paginationNavigationNode=_a(_14,"ul");if(this.firstLastArrows){_16=this.paginationFirstNode=_a(_15,"li>a[href=javascript:].dgrid-first","«");_16.innerHTML="&#171";_16.setAttribute("aria-label",_c.gotoFirst);_16.tabIndex=0;}if(this.previousNextArrows){_16=this.paginationPreviousNode=_a(_15,"li>a[href=javascript:].dgrid-previous","‹");_16.innerHTML="&#8249";_16.setAttribute("aria-label",_c.gotoPrev);_16.tabIndex=0;}this.paginationLinksNode=_a(_15,"span");if(this.previousNextArrows){_16=this.paginationNextNode=_a(_15,"li>a[href=javascript:].dgrid-next","›");_16.innerHTML="&#8250";_16.setAttribute("aria-label",_c.gotoNext);_16.tabIndex=0;}if(this.firstLastArrows){_16=this.paginationLastNode=_a(_15,"li>a[href=javascript:].dgrid-last","»");_16.innerHTML="&#187";_16.setAttribute("aria-label",_c.gotoLast);_16.tabIndex=0;}this._listeners.push(on(_15,"a:click,a:keydown",function(_17){if(_17.type==="keydown"&&_17.keyCode!==13){return;}var cls=this.className,_18,max;if(_11._isLoading||cls.indexOf("dgrid-page-disabled")>-1){return;}_18=_11._currentPage;max=Math.ceil(_11._total/_11.rowsPerPage);if(this===_11.paginationPreviousNode){_11.gotoPage(_18-1);}else{if(this===_11.paginationNextNode){_11.gotoPage(_18+1);}else{if(this===_11.paginationFirstNode){_11.gotoPage(1);}else{if(this===_11.paginationLastNode){_11.gotoPage(max);}else{if(cls==="dgrid-page-link"){_11.gotoPage(+this.innerHTML);}}}}}}));},destroy:function(){this.inherited(arguments);if(this._pagingTextBoxHandle){this._pagingTextBoxHandle.remove();}},_updatePaginationSizeSelect:function(){var _19=this.pageSizeOptions,_1a=this.paginationSizeSelect,_1b;if(_19&&_19.length){if(!_1a){_1a=this.paginationSizeSelect=_a(this.paginationNode,"select.dgrid-page-size[aria-label="+this.i18nPagination.rowsPerPage+"]");_1b=this._paginationSizeChangeHandle=on(_1a,"change",_4.hitch(this,function(){this.set("rowsPerPage",+this.paginationSizeSelect.value);}));this._listeners.push(_1b);}_1a.options.length=0;for(var i=0;i<_19.length;i++){_a(_1a,"option",_19[i],{value:_19[i],selected:this.rowsPerPage===_19[i]});}this._updateRowsPerPageOption();}else{if(!(_19&&_19.length)&&_1a){_a(_1a,"!");this.paginationSizeSelect=null;this._paginationSizeChangeHandle.remove();}}},_setPageSizeOptions:function(_1c){this.pageSizeOptions=_1c&&_1c.sort(function(a,b){return a-b;});this._updatePaginationSizeSelect();},_updateRowsPerPageOption:function(){var _1d=this.rowsPerPage,_1e=this.pageSizeOptions,_1f=this.paginationSizeSelect;if(_1f){if(_3.indexOf(_1e,_1d)<0){this._setPageSizeOptions(_1e.concat([_1d]));}else{_1f.value=""+_1d;}}},_setRowsPerPage:function(_20){this.rowsPerPage=_20;this._updateRowsPerPageOption();this.gotoPage(1);},_updateNavigation:function(){var _21=this,_c=this.i18nPagination,_22=this.paginationLinksNode,_23=this._currentPage,_24=this.pagingLinks,_25=this.paginationNavigationNode,end=Math.ceil(this._total/this.rowsPerPage),_26=this._pagingTextBoxHandle,_27=document.activeElement,_28,_29,_2a;if(this.rowsPerPage>=this._total){_5.add(this.paginationNode,"hidden");_5.add(this.paginationStatusNode,"hidden");return;}else{_5.remove(this.paginationNode,"hidden");_5.remove(this.paginationStatusNode,"hidden");}if(_21.showPaginationStatusNode==false){_5.add(this.paginationStatusNode,"hidden");}function _2b(_2c,_2d){var _2e;var _2f;if(_21.pagingTextBox&&_2c===_23&&end>1){_2e=_a(_22,"input.dgrid-page-input[type=text][value=$]",_23);_2e.setAttribute("aria-label",_c.jumpPage);_21._pagingTextBoxHandle=on(_2e,"change",function(){var _30=+this.value;if(!isNaN(_30)&&_30>0&&_30<=end){_21.gotoPage(+this.value);}});if(_27&&_27.tagName==="INPUT"){_2e.focus();}}else{_2f=_2c===_23;_2e=_a(_22,"li"+(_2f?".active":"")+">a[href=javascript:]"+(_2f?".dgrid-page-disabled":"")+".dgrid-page-link",_2c+(_2d?" ":""));_2e.setAttribute("aria-label",_c.gotoPage);_2e.tabIndex=_2f?-1:0;if(_28===_2c){_2e.focus();}}};function _31(_32,_33){_a(_32,(_33?".":"!")+"dgrid-page-disabled");_a(_32.parentNode,(_33?".":"!")+"disabled");_32.tabIndex=_33?-1:0;};if(!_27||!_b.contains(this.paginationNavigationNode,_27)){_27=null;}else{if(_27.className==="dgrid-page-link"){_28=+_27.innerHTML;}}if(_26){_26.remove();}_22.innerHTML="";_6(".dgrid-first, .dgrid-previous",_25).forEach(function(_34){_31(_34,_23===1);});_6(".dgrid-last, .dgrid-next",_25).forEach(function(_35){_31(_35,_23>=end);});if(_24&&end>0){_2b(1,true);var _36=_23-_24;if(_36>2){_a(_22,"li>a[href=javascript:].dgrid-page-skip","...");}else{_36=2;}for(var i=_36;i<Math.min(_23+_24+1,end);i++){_2b(i,true);}if(_23+_24+1<end){_a(_22,"li>a[href=javascript:].dgrid-page-skip","...");}if(end>1){_2b(end);}}else{if(_21.pagingTextBox){_2b(_23);}}if(_27&&_27.tabIndex===-1){_2a=_6("[tabindex=\"0\"]",this.paginationNavigationNode);if(_27===this.paginationPreviousNode||_27===this.paginationFirstNode){_27=_2a[0];}else{if(_2a.length){_27=_2a[_2a.length-1];}}if(_27){_27.focus();}}},_updatePaginationStatus:function(_37){var _38=this.rowsPerPage;var _39=Math.min(_37,(this._currentPage-1)*_38+1);this.paginationStatusNode.innerHTML=_7.substitute(this.i18nPagination.status,{start:_39,end:Math.min(_37,_39+_38-1),total:_37});},refresh:function(_3a){var _3b=this;var _3c=_3a&&_3a.keepCurrentPage?Math.min(this._currentPage,Math.ceil(this._total/this.rowsPerPage)):1;this.inherited(arguments);return this.gotoPage(_3c).then(function(_3d){_3b._lastCollection=_3d;setTimeout(function(){on.emit(_3b.domNode,"dgrid-refresh-complete",{bubbles:true,cancelable:false,grid:_3b});},0);return _3d;});},_onNotification:function(_3e,_3f,_40){var _41=this.rowsPerPage;var _42=this._currentPage*_41;var _43=(_3f.type==="add"&&_3f.index<_42)||(_3f.type==="delete"&&_3f.previousIndex<_42)||(_3f.type==="update"&&Math.floor(_3f.index/_41)!==Math.floor(_3f.previousIndex/_41));if(_43){this.gotoPage(Math.min(this._currentPage,Math.ceil(_3f.totalLength/this.rowsPerPage)));}else{if(_40===this._renderedCollection&&_3f.totalLength!==this._total){this._updatePaginationStatus(_3f.totalLength);this._updateNavigation();}}},renderQueryResults:function(_44,_45){var _46=this,_47=this.inherited(arguments);if(!_45){if(this._topLevelRequest){this._topLevelRequest.cancel();delete this._topLevelRequest;}if(typeof _47.cancel==="function"){this._topLevelRequest=_47;}_9(_47,function(){if(_46._topLevelRequest){delete _46._topLevelRequest;}});}return _47;},insertRow:function(){var _48=this._oldPageNodes,row=this.inherited(arguments);if(_48&&row===_48[row.id]){delete _48[row.id];}return row;},gotoPage:function(_49){var _4a=this,_4b=(this._currentPage-1)*this.rowsPerPage;if(!this._renderedCollection){console.warn("Pagination requires a collection to operate.");return _9([]);}if(this._renderedCollection.releaseRange){this._renderedCollection.releaseRange(_4b,_4b+this.rowsPerPage);}return this._trackError(function(){var _4c=_4a.rowsPerPage,_4b=(_49-1)*_4c,_4d={start:_4b,count:_4c},_4e,_4f=_4a.contentNode,_50,_51,_52,i,len;if(_4a.showLoadingMessage){_d(_4a);_50=_4a.loadingNode=_a(_4f,"div.dgrid-loading");_50.innerHTML=_4a.loadingMessage;}else{_4a._oldPageNodes=_51={};_52=_4f.children;for(i=0,len=_52.length;i<len;i++){_51[_52[i].id]=_52[i];}}_4a._isLoading=true;_4e=_4a._renderedCollection.fetchRange({start:_4b,end:_4b+_4c});return _4a.renderQueryResults(_4e,null,_4d).then(function(_53){_f(_4a);_4a.scrollTo({y:0});if(_4a._rows){_4a._rows.min=_4b;_4a._rows.max=_4b+_4c-1;}_9(_4e.totalLength,function(_54){if(!_54){if(_4a.noDataNode){_a(_4a.noDataNode,"!");delete _4a.noDataNode;}_4a.noDataNode=_a(_4a.contentNode,"div.dgrid-no-data");_4a.noDataNode.innerHTML=_4a.noDataMessage;}_4a._total=_54;_4a._currentPage=_49;_4a._rowsOnPage=_53&&_53.length||0;_4a._updatePaginationStatus(_54);_4a._updateNavigation();});return _4e;},function(_55){_f(_4a);throw _55;});});}});});