//>>built
define("oreilly/types/store/StoreAdapter",["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/when","dstore/Store","dstore/QueryResults"],function(_1,_2,_3,_4,_5,_6){var _7=function(_8){return function(){var _9=this.objectStore;return _9[_8].apply(_9,arguments);};};return _1(_5,{objectStore:null,get:function(){var _a=this,_b=this.objectStore;return _4(_b.get.apply(_b,arguments),function(_c){return _a._restore(_c);});},put:_7("put"),add:_7("add"),remove:_7("remove"),constructor:function(){this.inherited(arguments);if(this.objectStore["loadData"]){this.loadData=_7("loadData");}},getIdentity:_7("getIdentity"),_setIdentity:function(_d,_e){return (_d[this.objectStore.idProperty]=_e);},fetch:function(){return this.fetchRange();},fetchRange:function(_f){var _10={},_11=this.queryLog,_12=function(_13){return _3.map(_3.filter(_11,function(_14){return _14.type===_13;}),function(_15){return _15.normalizedArguments[0];});};var _16=_12("sort").pop();if(_16){_10.sort=_16;if(_16 instanceof Array){for(var i=0;i<_16.length;i++){var _17=_16[i];_17.attribute=_17.property;}}}if(_f){_10.count=_f.end-((_10.start=_f.start)||0);}var _18={};_19(_12("filter"));function _19(_1a){for(var i=0;i<_1a.length;i++){var _1b=_1a[i];var _1c=_1b.type;var _1d=_1b.args;if(_1c==="and"){_19(_1d);}else{if(_1c==="eq"||_1c==="match"){_18[_1d[0]]=_1d[1];}else{if(_1c==="string"){_18=_1d[0];}else{if(_1c==="function"){_18=_1d[0];}else{if(_1c){throw new Error("\""+_1c+" operator can not be converted to a legacy store query");}}}}}}};var _1e=this.objectStore.query(_18,_10);if(_1e){return new _6(_1e.map(this._restore,this),{totalLength:_1e.total});}return _1e;}});});