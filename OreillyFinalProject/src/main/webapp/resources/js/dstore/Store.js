//>>built
define("dstore/Store",["dojo/_base/lang","dojo/_base/array","dojo/aspect","dojo/has","dojo/when","dojo/Deferred","dojo/_base/declare","./QueryMethod","./Filter","dojo/Evented"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a){_4.add("object-proto",!!{}.__proto__&&!({}).watch);var _b=_4("object-proto");function _c(_d){return function(_e,_f){var _10=this;_5(_e,function(_11){var _12={target:_11},_13=_f[1]||{};if("beforeId" in _13){_12.beforeId=_13.beforeId;}_10.emit(_d,_12);});return _e;};};var _14=_a;return _7(_14,{constructor:function(_15){_15&&_7.safeMixin(this,_15);if(this.Model&&this.Model.createSubclass){this.Model=this.Model.createSubclass([]).extend({_store:this});}this.storage=new _a();var _16=this;if(this.autoEmitEvents){_3.after(this,"add",_c("add"));_3.after(this,"put",_c("update"));_3.after(this,"remove",function(_17,_18){_5(_17,function(){_16.emit("delete",{id:_18[0]});});return _17;});}},autoEmitEvents:true,idProperty:"id",queryAccessors:true,getIdentity:function(_19){return _19.get?_19.get(this.idProperty):_19[this.idProperty];},_setIdentity:function(_1a,_1b){if(_1a.set){_1a.set(this.idProperty,_1b);}else{_1a[this.idProperty]=_1b;}},forEach:function(_1c,_1d){var _1e=this;return _5(this.fetch(),function(_1f){for(var i=0,l=_1f.length;i<l;i++){_1c.call(_1d,_1f[i],i,_1e);}return _1f;});},on:function(_20,_21){return this.storage.on(_20,_21);},emit:function(_22,_23){_23=_23||{};_23.type=_22;try{return this.storage.emit(_22,_23);}finally{return _23.cancelable;}},parse:null,stringify:null,Model:null,_restore:function(_24,_25){var _26=this.Model;if(_26&&_24){var _27=_26.prototype;var _28=_27._restore;if(_28){_24=_28.call(_24,_26,_25);}else{if(_b&&_25){_24.__proto__=_27;}else{_24=_1.delegate(_27,_24);}}}return _24;},create:function(_29){return new this.Model(_29);},_createSubCollection:function(_2a){var _2b=_1.delegate(this.constructor.prototype);for(var i in this){if(this._includePropertyInSubCollection(i,_2b)){_2b[i]=this[i];}}return _7.safeMixin(_2b,_2a);},_includePropertyInSubCollection:function(_2c,_2d){return !(_2c in _2d)||_2d[_2c]!==this[_2c];},queryLog:[],filter:new _8({type:"filter",normalizeArguments:function(_2e){var _2f=this.Filter;if(_2e instanceof _2f){return [_2e];}return [new _2f(_2e)];}}),Filter:_9,sort:new _8({type:"sort",normalizeArguments:function(_30,_31){var _32;if(typeof _30==="function"){_32=[_30];}else{if(_30 instanceof Array){_32=_30.slice();}else{if(typeof _30==="object"){_32=[].slice.call(arguments);}else{_32=[{property:_30,descending:_31}];}}_32=_2.map(_32,function(_33){_33=_1.mixin({},_33);_33.descending=!!_33.descending;return _33;});_32=[_32];}return _32;}}),_getQuerierFactory:function(_34){var _35=_34[0].toUpperCase()+_34.substr(1);return this["_create"+_35+"Querier"];}});});