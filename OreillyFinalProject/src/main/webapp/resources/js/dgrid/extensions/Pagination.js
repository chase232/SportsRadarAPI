//>>built
define("dgrid/extensions/Pagination",["../_StoreMixin","dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/on","dojo/query","dojo/string","dojo/has","dojo/when","put-selector/put","../util/misc","dojo/i18n!./nls/pagination","dojo/_base/sniff","xstyle/css!../css/extensions/Pagination.css"],function(_1,_2,_3,_4,on,_5,_6,_7,_8,_9,_a,_b){function _c(_d){if(_d.noDataNode){_9(_d.noDataNode,"!");delete _d.noDataNode;}else{_d.cleanup();}_d.contentNode.innerHTML="";};function _e(_f){if(_f.loadingNode){_9(_f.loadingNode,"!");delete _f.loadingNode;}else{if(_f._oldPageNodes){for(var id in _f._oldPageNodes){_f.removeRow(_f._oldPageNodes[id]);}delete _f._oldPageNodes;}}delete _f._isLoading;};return _2(_1,{rowsPerPage:10,pagingTextBox:false,previousNextArrows:true,firstLastArrows:false,pagingLinks:2,pageSizeOptions:null,showLoadingMessage:true,i18nPagination:_b,showFooter:true,_currentPage:1,buildRendering:function(){this.inherited(arguments);var _10=this,_11=this.paginationNode=_9(this.footerNode,"div.dgrid-pagination"),_12=this.paginationStatusNode=_9(_11,"div.dgrid-status"),_b=this.i18nPagination,_13,_14;_12.tabIndex=0;this._updatePaginationSizeSelect();this._updateRowsPerPageOption();this._updatePaginationStatus(this._total);_13=this.paginationNavigationNode=_9(_11,"div.dgrid-navigation");if(this.firstLastArrows){_14=this.paginationFirstNode=_9(_13,"span.dgrid-first.dgrid-page-link","«");_14.setAttribute("aria-label",_b.gotoFirst);_14.tabIndex=0;}if(this.previousNextArrows){_14=this.paginationPreviousNode=_9(_13,"span.dgrid-previous.dgrid-page-link","‹");_14.setAttribute("aria-label",_b.gotoPrev);_14.tabIndex=0;}this.paginationLinksNode=_9(_13,"span.dgrid-pagination-links");if(this.previousNextArrows){_14=this.paginationNextNode=_9(_13,"span.dgrid-next.dgrid-page-link","›");_14.setAttribute("aria-label",_b.gotoNext);_14.tabIndex=0;}if(this.firstLastArrows){_14=this.paginationLastNode=_9(_13,"span.dgrid-last.dgrid-page-link","»");_14.setAttribute("aria-label",_b.gotoLast);_14.tabIndex=0;}this._listeners.push(on(_13,".dgrid-page-link:click,.dgrid-page-link:keydown",function(_15){if(_15.type==="keydown"&&_15.keyCode!==13){return;}var cls=this.className,_16,max;if(_10._isLoading||cls.indexOf("dgrid-page-disabled")>-1){return;}_16=_10._currentPage;max=Math.ceil(_10._total/_10.rowsPerPage);if(this===_10.paginationPreviousNode){_10.gotoPage(_16-1);}else{if(this===_10.paginationNextNode){_10.gotoPage(_16+1);}else{if(this===_10.paginationFirstNode){_10.gotoPage(1);}else{if(this===_10.paginationLastNode){_10.gotoPage(max);}else{if(cls==="dgrid-page-link"){_10.gotoPage(+this.innerHTML);}}}}}}));},destroy:function(){this.inherited(arguments);if(this._pagingTextBoxHandle){this._pagingTextBoxHandle.remove();}},_updatePaginationSizeSelect:function(){var _17=this.pageSizeOptions,_18=this.paginationSizeSelect,_19;if(_17&&_17.length){if(!_18){_18=this.paginationSizeSelect=_9(this.paginationNode,"select.dgrid-page-size[aria-label="+this.i18nPagination.rowsPerPage+"]");_19=this._paginationSizeChangeHandle=on(_18,"change",_4.hitch(this,function(){this.set("rowsPerPage",+this.paginationSizeSelect.value);}));this._listeners.push(_19);}_18.options.length=0;for(var i=0;i<_17.length;i++){_9(_18,"option",_17[i],{value:_17[i],selected:this.rowsPerPage===_17[i]});}this._updateRowsPerPageOption();}else{if(!(_17&&_17.length)&&_18){_9(_18,"!");this.paginationSizeSelect=null;this._paginationSizeChangeHandle.remove();}}},_setPageSizeOptions:function(_1a){this.pageSizeOptions=_1a&&_1a.sort(function(a,b){return a-b;});this._updatePaginationSizeSelect();},_updateRowsPerPageOption:function(){var _1b=this.rowsPerPage,_1c=this.pageSizeOptions,_1d=this.paginationSizeSelect;if(_1d){if(_3.indexOf(_1c,_1b)<0){this._setPageSizeOptions(_1c.concat([_1b]));}else{_1d.value=""+_1b;}}},_setRowsPerPage:function(_1e){this.rowsPerPage=_1e;this._updateRowsPerPageOption();this.gotoPage(1);},_updateNavigation:function(){var _1f=this,_b=this.i18nPagination,_20=this.paginationLinksNode,_21=this._currentPage,_22=this.pagingLinks,_23=this.paginationNavigationNode,end=Math.ceil(this._total/this.rowsPerPage),_24=this._pagingTextBoxHandle,_25=document.activeElement,_26,_27,_28;function _29(_2a,_2b){var _2c;var _2d;if(_1f.pagingTextBox&&_2a===_21&&end>1){_2c=_9(_20,"input.dgrid-page-input[type=text][value=$]",_21);_2c.setAttribute("aria-label",_b.jumpPage);_1f._pagingTextBoxHandle=on(_2c,"change",function(){var _2e=+this.value;if(!isNaN(_2e)&&_2e>0&&_2e<=end){_1f.gotoPage(+this.value);}});if(_25&&_25.tagName==="INPUT"){_2c.focus();}}else{_2d=_2a===_21;_2c=_9(_20,"span"+(_2d?".dgrid-page-disabled":"")+".dgrid-page-link",_2a+(_2b?" ":""));_2c.setAttribute("aria-label",_b.gotoPage);_2c.tabIndex=_2d?-1:0;if(_26===_2a){if(!_2d){_2c.focus();}else{if(_2a<end){_26++;}else{_27.focus();}}}if(!_2d){_27=_2c;}}};function _2f(_30,_31){_9(_30,(_31?".":"!")+"dgrid-page-disabled");_30.tabIndex=_31?-1:0;};if(!_25||!_a.contains(this.paginationNavigationNode,_25)){_25=null;}else{if(_25.className==="dgrid-page-link"){_26=+_25.innerHTML;}}if(_24){_24.remove();}_20.innerHTML="";_5(".dgrid-first, .dgrid-previous",_23).forEach(function(_32){_2f(_32,_21===1);});_5(".dgrid-last, .dgrid-next",_23).forEach(function(_33){_2f(_33,_21>=end);});if(_22&&end>0){_29(1,true);var _34=_21-_22;if(_34>2){_9(_20,"span.dgrid-page-skip","...");}else{_34=2;}for(var i=_34;i<Math.min(_21+_22+1,end);i++){_29(i,true);}if(_21+_22+1<end){_9(_20,"span.dgrid-page-skip","...");}if(end>1){_29(end);}}else{if(_1f.pagingTextBox){_29(_21);}}if(_25&&_25.tabIndex===-1){_28=_5("[tabindex=\"0\"]",this.paginationNavigationNode);if(_25===this.paginationPreviousNode||_25===this.paginationFirstNode){_25=_28[0];}else{if(_28.length){_25=_28[_28.length-1];}}if(_25){_25.focus();}}},_updatePaginationStatus:function(_35){var _36=this.rowsPerPage;var _37=Math.min(_35,(this._currentPage-1)*_36+1);this.paginationStatusNode.innerHTML=_6.substitute(this.i18nPagination.status,{start:_37,end:Math.min(_35,_37+_36-1),total:_35});},refresh:function(_38){var _39=this;var _3a=_38&&_38.keepCurrentPage?Math.min(this._currentPage,Math.ceil(this._total/this.rowsPerPage)):1;this.inherited(arguments);return this.gotoPage(_3a).then(function(_3b){setTimeout(function(){on.emit(_39.domNode,"dgrid-refresh-complete",{bubbles:true,cancelable:false,grid:_39});},0);return _3b;});},_onNotification:function(_3c,_3d,_3e){var _3f=this.rowsPerPage;var _40=this._currentPage*_3f;var _41=(_3d.type==="add"&&_3d.index<_40)||(_3d.type==="delete"&&_3d.previousIndex<_40)||(_3d.type==="update"&&Math.floor(_3d.index/_3f)!==Math.floor(_3d.previousIndex/_3f));if(_41){this.gotoPage(Math.min(this._currentPage,Math.ceil(_3d.totalLength/this.rowsPerPage)));}else{if(_3e===this._renderedCollection&&_3d.totalLength!==this._total){this._updatePaginationStatus(_3d.totalLength);this._updateNavigation();}}},renderQueryResults:function(_42,_43){var _44=this,_45=this.inherited(arguments);if(!_43){if(this._topLevelRequest){this._topLevelRequest.cancel();delete this._topLevelRequest;}if(typeof _45.cancel==="function"){this._topLevelRequest=_45;}_8(_45,function(){if(_44._topLevelRequest){delete _44._topLevelRequest;}});}return _45;},insertRow:function(){var _46=this._oldPageNodes,row=this.inherited(arguments);if(_46&&row===_46[row.id]){delete _46[row.id];}return row;},gotoPage:function(_47){var _48=this,_49=(this._currentPage-1)*this.rowsPerPage;if(!this._renderedCollection){console.warn("Pagination requires a collection to operate.");return _8([]);}if(this._renderedCollection.releaseRange){this._renderedCollection.releaseRange(_49,_49+this.rowsPerPage);}return this._trackError(function(){var _4a=_48.rowsPerPage,_49=(_47-1)*_4a,_4b={start:_49,count:_4a},_4c,_4d=_48.contentNode,_4e,_4f,_50,i,len;if(_48.showLoadingMessage){_c(_48);_4e=_48.loadingNode=_9(_4d,"div.dgrid-loading");_4e.innerHTML=_48.loadingMessage;}else{_48._oldPageNodes=_4f={};_50=_4d.children;for(i=0,len=_50.length;i<len;i++){_4f[_50[i].id]=_50[i];}}_48._isLoading=true;_4c=_48._renderedCollection.fetchRange({start:_49,end:_49+_4a});return _48.renderQueryResults(_4c,null,_4b).then(function(_51){_e(_48);_48.scrollTo({y:0});if(_48._rows){_48._rows.min=_49;_48._rows.max=_49+_4a-1;}_8(_4c.totalLength,function(_52){if(!_52){if(_48.noDataNode){_9(_48.noDataNode,"!");delete _48.noDataNode;}_48.noDataNode=_9(_48.contentNode,"div.dgrid-no-data");_48.noDataNode.innerHTML=_48.noDataMessage;}_48._total=_52;_48._currentPage=_47;_48._rowsOnPage=_51.length;_48._updatePaginationStatus(_52);_48._updateNavigation();});return _4c;},function(_53){_e(_48);throw _53;});});}});});